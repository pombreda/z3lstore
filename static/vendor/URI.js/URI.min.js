/*
 * URI.js - Mutating URLs
 *
 * Version: 1.6.3
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.com/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *   GPL v3 http://opensource.org/licenses/GPL-3.0
 *
 */
(function(g){var m=typeof module!=="undefined"&&module.exports,b=function(p){return m?require("./"+p):window[p]},c=b("punycode"),d=b("IPv6"),i=b("SecondLevelDomains"),j=function(p,q){if(!(this instanceof j)){return new j(p)}if(p===g){p=location.href+""}this.href(p);if(q!==g){return this.absoluteTo(q)}return this},r=j.prototype;function e(p){return p.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function n(p){return String(Object.prototype.toString.call(p))==="[object Array]"}function l(v,u){var w={},p,q;if(n(u)){for(p=0,q=u.length;p<q;p++){w[u[p]]=true}}else{w[u]=true}for(p=0,q=v.length;p<q;p++){if(w[v[p]]!==g){v.splice(p,1);q--;p--}}return v}j.idn_expression=/[^a-z0-9\.-]/i;j.punycode_expression=/(xn--)/i;j.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/;j.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/;j.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig;j.defaultPorts={http:"80",https:"443",ftp:"21"};j.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/;j.encode=encodeURIComponent;j.decode=decodeURIComponent;j.iso8859=function(){j.encode=escape;j.decode=unescape};j.unicode=function(){j.encode=encodeURIComponent;j.decode=decodeURIComponent};j.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}}};j.encodeQuery=function(p){return j.encode(p+"").replace(/%20/g,"+")};j.decodeQuery=function(p){return j.decode((p+"").replace(/\+/g,"%20"))};j.recodePath=function(q){var p=(q+"").split("/");for(var u=0,v=p.length;u<v;u++){p[u]=j.encodePathSegment(j.decode(p[u]))}return p.join("/")};j.decodePath=function(q){var p=(q+"").split("/");for(var u=0,v=p.length;u<v;u++){p[u]=j.decodePathSegment(p[u])}return p.join("/")};var f={encode:"encode",decode:"decode"},h,k=function(p){return function(q){return j[p](q+"").replace(j.characters.pathname[p].expression,function(u){return j.characters.pathname[p].map[u]})}};for(h in f){j[h+"PathSegment"]=k(f[h])}j.parse=function(p){var v,q,u={};v=p.indexOf("#");if(v>-1){u.fragment=p.substring(v+1)||null;p=p.substring(0,v)}v=p.indexOf("?");if(v>-1){u.query=p.substring(v+1)||null;p=p.substring(0,v)}if(p.substring(0,2)==="//"){u.protocol="";p=p.substring(2);p=j.parseAuthority(p,u)}else{v=p.indexOf(":");if(v>-1){u.protocol=p.substring(0,v);if(p.substring(v+1,v+3)==="//"){p=p.substring(v+3);p=j.parseAuthority(p,u)}else{p=p.substring(v+1);u.urn=true}}}u.path=p;return u};j.parseHost=function(p,u){var w=p.indexOf("/"),q;if(w===-1){w=p.length}if(p[0]==="["){var v=p.indexOf("]");u.hostname=p.substring(1,v)||null;u.port=p.substring(v+2,w)||null}else{if(p.indexOf(":")!==p.lastIndexOf(":")){u.hostname=p.substring(0,w)||null;u.port=null}else{q=p.substring(0,w).split(":");u.hostname=q[0]||null;u.port=q[1]||null}}if(u.hostname&&p.substring(w)[0]!=="/"){w++;p="/"+p}return p.substring(w)||"/"};j.parseAuthority=function(p,q){p=j.parseUserinfo(p,q);return j.parseHost(p,q)};j.parseUserinfo=function(q,v){var w=q.indexOf("@"),p=q.indexOf("/"),u;if(w>-1&&(p===-1||w<p)){u=q.substring(0,w).split(":");v.username=u[0]?j.decode(u[0]):null;v.password=u[1]?j.decode(u[1]):null;q=q.substring(w+1)}else{v.username=null;v.password=null}return q};j.parseQuery=function(w){if(!w){return{}}w=w.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"");if(!w){return{}}var q={},A=w.split("&"),y=A.length;for(var x=0;x<y;x++){var p=A[x].split("="),u=j.decodeQuery(p.shift()),z=p.length?j.decodeQuery(p.join("=")):null;if(q[u]){if(typeof q[u]==="string"){q[u]=[q[u]]}q[u].push(z)}else{q[u]=z}}return q};j.build=function(q){var p="";if(q.protocol){p+=q.protocol+":"}if(!q.urn&&(p||q.hostname)){p+="//"}p+=(j.buildAuthority(q)||"");if(typeof q.path==="string"){if(q.path[0]!=="/"&&typeof q.hostname==="string"){p+="/"}p+=q.path}if(typeof q.query==="string"&&""!==q.query){p+="?"+q.query}if(typeof q.fragment==="string"&&""!==q.fragment){p+="#"+q.fragment}return p};j.buildHost=function(q){var p="";if(!q.hostname){return""}else{if(j.ip6_expression.test(q.hostname)){if(q.port){p+="["+q.hostname+"]:"+q.port}else{p+=q.hostname}}else{p+=q.hostname;if(q.port){p+=":"+q.port}}}return p};j.buildAuthority=function(p){return j.buildUserinfo(p)+j.buildHost(p)};j.buildUserinfo=function(q){var p="";if(q.username){p+=j.encode(q.username);if(q.password){p+=":"+j.encode(q.password)}p+="@"}return p};j.buildQuery=function(w,y){var u="";for(var q in w){if(Object.hasOwnProperty.call(w,q)&&q){if(n(w[q])){var x={};for(var p=0,v=w[q].length;p<v;p++){if(w[q][p]!==g&&x[w[q][p]+""]===g){u+="&"+j.buildQueryParameter(q,w[q][p]);if(y!==true){x[w[q][p]+""]=true}}}}else{if(w[q]!==g){u+="&"+j.buildQueryParameter(q,w[q])}}}}return u.substring(1)};j.buildQueryParameter=function(p,q){return j.encodeQuery(p)+(q!==null?"="+j.encodeQuery(q):"")};j.addQuery=function(v,p,u){if(typeof p==="object"){for(var q in p){if(Object.prototype.hasOwnProperty.call(p,q)){j.addQuery(v,q,p[q])}}}else{if(typeof p==="string"){if(v[p]===g){v[p]=u;return}else{if(typeof v[p]==="string"){v[p]=[v[p]]}}if(!n(u)){u=[u]}v[p]=v[p].concat(u)}else{throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")}}};j.removeQuery=function(x,p,w){if(n(p)){for(var u=0,v=p.length;u<v;u++){x[p[u]]=g}}else{if(typeof p==="object"){for(var q in p){if(Object.prototype.hasOwnProperty.call(p,q)){j.removeQuery(x,q,p[q])}}}else{if(typeof p==="string"){if(w!==g){if(x[p]===w){x[p]=g}else{if(n(x[p])){x[p]=l(x[p],w)}}}else{x[p]=g}}else{throw new TypeError("URI.addQuery() accepts an object, string as the first parameter")}}}};j.commonPath=function(q,p){var u=Math.min(q.length,p.length),v;for(v=0;v<u;v++){if(q[v]!==p[v]){v--;break}}if(v<1){return q[0]===p[0]&&q[0]==="/"?"/":""}if(q[v]!=="/"){v=q.substring(0,v).lastIndexOf("/")}return q.substring(0,v+1)};j.withinString=function(p,q){return p.replace(j.find_uri_expression,q)};j.ensureValidHostname=function(p){if(p.match(j.invalid_hostname_characters)){if(!c){throw new TypeError("Hostname '"+p+"' contains characters other than [A-Z0-9.-] and Punycode.js is not available")}if(c.toASCII(p).match(j.invalid_hostname_characters)){throw new TypeError("Hostname '"+p+"' contains characters other than [A-Z0-9.-]")}}};r.build=function(p){if(p===true){this._deferred_build=true}else{if(p===g||this._deferred_build){this._string=j.build(this._parts);this._deferred_build=false}}return this};r.clone=function(){return new j(this)};r.toString=function(){return this.build(false)._string};r.valueOf=function(){return this.toString()};f={protocol:"protocol",username:"username",password:"password",hostname:"hostname",port:"port"};k=function(p){return function(q,u){if(q===g){return this._parts[p]||""}else{this._parts[p]=q;this.build(!u);return this}}};for(h in f){r[h]=k(f[h])}f={query:"?",fragment:"#"};k=function(p,q){return function(u,w){if(u===g){return this._parts[p]||""}else{if(u!==null){u=u+"";if(u[0]===q){u=u.substring(1)}}this._parts[p]=u;this.build(!w);return this}}};for(h in f){r[h]=k(h,f[h])}f={search:["?","query"],hash:["#","fragment"]};k=function(p,q){return function(u,x){var w=this[p](u,x);return typeof w==="string"&&w.length?(q+w):w}};for(h in f){r[h]=k(f[h][1],f[h][0])}r.pathname=function(p,u){if(p===g||p===true){var q=this._parts.path||(this._parts.urn?"":"/");return p?j.decodePath(q):q}else{this._parts.path=p?j.recodePath(p):"/";this.build(!u);return this}};r.path=r.pathname;r.href=function(p,x){if(p===g){return this.toString()}else{this._string="";this._parts={protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null};var u=p instanceof j,v=typeof p==="object"&&(p.hostname||p.path),q;if(typeof p==="string"){this._parts=j.parse(p)}else{if(u||v){var w=u?p._parts:p;for(q in w){if(Object.hasOwnProperty.call(this._parts,q)){this._parts[q]=w[q]}}}else{throw new TypeError("invalid input")}}this.build(!x);return this}};r.is=function(A){var x=false,y=false,w=false,u=false,q=false,v=false,z=false,p=!this._parts.urn;if(this._parts.hostname){p=false;y=j.ip4_expression.test(this._parts.hostname);w=j.ip6_expression.test(this._parts.hostname);x=y||w;u=!x;q=u&&i&&i.has(this._parts.hostname);v=u&&j.idn_expression.test(this._parts.hostname);z=u&&j.punycode_expression.test(this._parts.hostname)}switch(A.toLowerCase()){case"relative":return p;case"absolute":return !p;case"domain":case"name":return u;case"sld":return q;case"ip":return x;case"ip4":case"ipv4":case"inet4":return y;case"ip6":case"ipv6":case"inet6":return w;case"idn":return v;case"url":return !this._parts.urn;case"urn":return !!this._parts.urn;case"punycode":return z}return null};var t=r.protocol,a=r.port,s=r.hostname;r.protocol=function(p,q){if(p!==g){if(p){p=p.replace(/:(\/\/)?$/,"");if(p.match(/[^a-zA-z0-9\.+-]/)){throw new TypeError("Protocol '"+p+"' contains characters other than [A-Z0-9.+-]")}}}return t.call(this,p,q)};r.scheme=r.protocol;r.port=function(p,q){if(this._parts.urn){return p===g?"":this}if(p!==g){if(p===0){p=null}if(p){p+="";if(p[0]===":"){p=p.substring(1)}if(p.match(/[^0-9]/)){throw new TypeError("Port '"+p+"' contains characters other than [0-9]")}}}return a.call(this,p,q)};r.hostname=function(q,u){if(this._parts.urn){return q===g?"":this}if(q!==g){var p={};j.parseHost(q,p);q=p.hostname}return s.call(this,q,u)};r.host=function(p,q){if(this._parts.urn){return p===g?"":this}if(p===g){return this._parts.hostname?j.buildHost(this._parts):""}else{j.parseHost(p,this._parts);this.build(!q);return this}};r.authority=function(p,q){if(this._parts.urn){return p===g?"":this}if(p===g){return this._parts.hostname?j.buildAuthority(this._parts):""}else{j.parseAuthority(p,this._parts);this.build(!q);return this}};r.userinfo=function(p,u){if(this._parts.urn){return p===g?"":this}if(p===g){if(!this._parts.username){return""}var q=j.buildUserinfo(this._parts);return q.substring(0,q.length-1)}else{if(p[p.length-1]!=="@"){p+="@"}j.parseUserinfo(p,this._parts);this.build(!u);return this}};r.subdomain=function(q,y){if(this._parts.urn){return q===g?"":this}if(q===g){if(!this._parts.hostname||this.is("IP")){return""}var p=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,p)||""}else{var x=this._parts.hostname.length-this.domain().length,w=this._parts.hostname.substring(0,x),u=new RegExp("^"+e(w));if(q&&q[q.length-1]!=="."){q+="."}if(q){j.ensureValidHostname(q)}this._parts.hostname=this._parts.hostname.replace(u,q);this.build(!y);return this}};r.domain=function(q,x){if(this._parts.urn){return q===g?"":this}if(typeof q=="boolean"){x=q;q=g}if(q===g){if(!this._parts.hostname||this.is("IP")){return""}var w=this._parts.hostname.match(/\./g);if(w&&w.length<2){return this._parts.hostname}var p=this._parts.hostname.length-this.tld(x).length-1;p=this._parts.hostname.lastIndexOf(".",p-1)+1;return this._parts.hostname.substring(p)||""}else{if(!q){throw new TypeError("cannot set domain empty")}j.ensureValidHostname(q);if(!this._parts.hostname||this.is("IP")){this._parts.hostname=q}else{var u=new RegExp(e(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(u,q)}this.build(!x);return this}};r.tld=function(p,w){if(this._parts.urn){return p===g?"":this}if(typeof p=="boolean"){w=p;p=g}if(p===g){if(!this._parts.hostname||this.is("IP")){return""}var x=this._parts.hostname.lastIndexOf("."),q=this._parts.hostname.substring(x+1);if(w!==true&&i&&i.list[q.toLowerCase()]){return i.get(this._parts.hostname)||q}return q}else{var u;if(!p){throw new TypeError("cannot set TLD empty")}else{if(p.match(/[^a-zA-Z0-9-]/)){if(i&&i.is(p)){u=new RegExp(e(this.tld())+"$");this._parts.hostname=this._parts.hostname.replace(u,p)}else{throw new TypeError("TLD '"+p+"' contains characters other than [A-Z0-9]")}}else{if(!this._parts.hostname||this.is("IP")){throw new ReferenceError("cannot set TLD on non-domain host")}else{u=new RegExp(e(this.tld())+"$");this._parts.hostname=this._parts.hostname.replace(u,p)}}}this.build(!w);return this}};r.directory=function(u,z){if(this._parts.urn){return u===g?"":this}if(u===g||u===true){if(!this._parts.path&&!this._parts.hostname){return""}if(this._parts.path==="/"){return"/"}var q=this._parts.path.length-this.filename().length-1,x=this._parts.path.substring(0,q)||(this._parts.hostname?"/":"");return u?j.decodePath(x):x}else{var y=this._parts.path.length-this.filename().length,p=this._parts.path.substring(0,y),w=new RegExp("^"+e(p));if(!this.is("relative")){if(!u){u="/"}if(u[0]!=="/"){u="/"+u}}if(u&&u[u.length-1]!=="/"){u+="/"}u=j.recodePath(u);this._parts.path=this._parts.path.replace(w,u);this.build(!z);return this}};r.filename=function(q,x){if(this._parts.urn){return q===g?"":this}if(q===g||q===true){if(!this._parts.path||this._parts.path==="/"){return""}var y=this._parts.path.lastIndexOf("/"),w=this._parts.path.substring(y+1);return q?j.decodePathSegment(w):w}else{var p=false;if(q[0]==="/"){q=q.substring(1)}if(q.match(/\.?\//)){p=true}var u=new RegExp(e(this.filename())+"$");q=j.recodePath(q);this._parts.path=this._parts.path.replace(u,q);if(p){this.normalizePath(x)}else{this.build(!x)}return this}};r.suffix=function(q,z){if(this._parts.urn){return q===g?"":this}if(q===g||q===true){if(!this._parts.path||this._parts.path==="/"){return""}var p=this.filename(),A=p.lastIndexOf("."),x,w;if(A===-1){return""}x=p.substring(A+1);w=(/^[a-z0-9%]+$/i).test(x)?x:"";return q?j.decodePathSegment(w):w}else{if(q[0]==="."){q=q.substring(1)}var y=this.suffix(),u;if(!y){if(!q){return this}this._parts.path+="."+j.recodePath(q)}else{if(!q){u=new RegExp(e("."+y)+"$")}else{u=new RegExp(e(y)+"$")}}if(u){q=j.recodePath(q);this._parts.path=this._parts.path.replace(u,q)}this.build(!z);return this}};var o=r.query;r.query=function(p,q){if(p===true){return j.parseQuery(this._parts.query)}else{if(p!==g&&typeof p!=="string"){this._parts.query=j.buildQuery(p);this.build(!q);return this}else{return o.call(this,p,q)}}};r.addQuery=function(p,u,v){var q=j.parseQuery(this._parts.query);j.addQuery(q,p,u);this._parts.query=j.buildQuery(q);if(typeof p!=="string"){v=u}this.build(!v);return this};r.removeQuery=function(p,u,v){var q=j.parseQuery(this._parts.query);j.removeQuery(q,p,u);this._parts.query=j.buildQuery(q);if(typeof p!=="string"){v=u}this.build(!v);return this};r.addSearch=r.addQuery;r.removeSearch=r.removeQuery;r.normalize=function(){if(this._parts.urn){return this.normalizeProtocol(false).normalizeQuery(false).normalizeFragment(false).build()}return this.normalizeProtocol(false).normalizeHostname(false).normalizePort(false).normalizePath(false).normalizeQuery(false).normalizeFragment(false).build()};r.normalizeProtocol=function(p){if(typeof this._parts.protocol==="string"){this._parts.protocol=this._parts.protocol.toLowerCase();this.build(!p)}return this};r.normalizeHostname=function(p){if(this._parts.hostname){if(this.is("IDN")&&c){this._parts.hostname=c.toASCII(this._parts.hostname)}else{if(this.is("IPv6")&&d){this._parts.hostname=d.best(this._parts.hostname)}}this._parts.hostname=this._parts.hostname.toLowerCase();this.build(!p)}return this};r.normalizePort=function(p){if(typeof this._parts.protocol==="string"&&this._parts.port===j.defaultPorts[this._parts.protocol]){this._parts.port=null;this.build(!p)}return this};r.normalizePath=function(x){if(this._parts.urn){return this}if(!this._parts.path||this._parts.path==="/"){return this}var u,q,v=this._parts.path,w,p;if(v[0]!=="/"){if(v[0]==="."){q=v.substring(0,v.indexOf("/"))}u=true;v="/"+v}v=v.replace(/(\/(\.\/)+)|\/{2,}/g,"/");while(true){w=v.indexOf("/../");if(w===-1){break}else{if(w===0){v=v.substring(3);break}}p=v.substring(0,w).lastIndexOf("/");if(p===-1){p=w}v=v.substring(0,p)+v.substring(w+3)}if(u&&this.is("relative")){if(q){v=q+v}else{v=v.substring(1)}}v=j.recodePath(v);this._parts.path=v;this.build(!x);return this};r.normalizePathname=r.normalizePath;r.normalizeQuery=function(p){if(typeof this._parts.query==="string"){if(!this._parts.query.length){this._parts.query=null}else{this.query(j.parseQuery(this._parts.query))}this.build(!p)}return this};r.normalizeFragment=function(p){if(!this._parts.fragment){this._parts.fragment=null;this.build(!p)}return this};r.normalizeSearch=r.normalizeQuery;r.normalizeHash=r.normalizeFragment;r.iso8859=function(){var p=j.encode,q=j.decode;j.encode=escape;j.decode=decodeURIComponent;this.normalize();j.encode=p;j.decode=q;return this};r.unicode=function(){var p=j.encode,q=j.decode;j.encode=encodeURIComponent;j.decode=unescape;this.normalize();j.encode=p;j.decode=q;return this};r.readable=function(){var x=this.clone();x.username("").password("").normalize();var w="";if(x._parts.protocol){w+=x._parts.protocol+"://"}if(x._parts.hostname){if(x.is("punycode")&&c){w+=c.toUnicode(x._parts.hostname);if(x._parts.port){w+=":"+x._parts.port}}else{w+=x.host()}}if(x._parts.hostname&&x._parts.path&&x._parts.path[0]!=="/"){w+="/"}w+=x.path(true);if(x._parts.query){var z="";for(var v=0,u=x._parts.query.split("&"),p=u.length;v<p;v++){var y=(u[v]||"").split("=");z+="&"+j.decodeQuery(y[0]).replace(/&/g,"%26");if(y[1]!==g){z+="="+j.decodeQuery(y[1]).replace(/&/g,"%26")}}w+="?"+z.substring(1)}w+=x.hash();return w};r.absoluteTo=function(w){var q=this.clone(),v=["protocol","username","password","hostname","port"],y;if(this._parts.urn){throw new Error("URNs do not have any generally defined hierachical components")}if(this._parts.hostname){return q}if(!(w instanceof j)){w=new j(w)}for(var u=0,x;x=v[u];u++){q._parts[x]=w._parts[x]}if(q.path()[0]!=="/"){y=w.directory();q._parts.path=(y?(y+"/"):"")+q._parts.path;q.normalizePath()}q.build();return q};r.relativeTo=function(w){var u=this.clone(),z=["protocol","username","password","hostname","port"],y,C;if(this._parts.urn){throw new Error("URNs do not have any generally defined hierachical components")}if(!(w instanceof j)){w=new j(w)}if(this.path()[0]!=="/"||w.path()[0]!=="/"){throw new Error("Cannot calculate common path from non-relative URLs")}y=j.commonPath(u.path(),w.path());C=w.directory();for(var x=0,v;v=z[x];x++){u._parts[v]=null}if(!y||y==="/"){return u}if(C+"/"===y){u._parts.path="./"+u.filename()}else{var B="../",q=new RegExp("^"+e(y)),A=C.replace(q,"/").match(/\//g).length-1;while(A--){B+="../"}u._parts.path=u._parts.path.replace(q,B)}u.build();return u};r.equals=function(q){var w=this.clone(),C=new j(q),x={},p={},z={},y,B,A;w.normalize();C.normalize();if(w.toString()===C.toString()){return true}y=w.query();B=C.query();w.query("");C.query("");if(w.toString()!==C.toString()){return false}if(y.length!==B.length){return false}x=j.parseQuery(y);p=j.parseQuery(B);for(A in x){if(Object.prototype.hasOwnProperty.call(x,A)){if(!n(x[A])){if(x[A]!==p[A]){return false}}else{if(!n(p[A])){return false}if(x[A].length!==p[A].length){return false}x[A].sort();p[A].sort();for(var v=0,u=x[A].length;v<u;v++){if(x[A][v]!==p[A][v]){return false}}}z[A]=true}}for(A in p){if(Object.prototype.hasOwnProperty.call(p,A)){if(!z[A]){return false}}}return true};(typeof module!=="undefined"&&module.exports?module.exports=j:window.URI=j)})();